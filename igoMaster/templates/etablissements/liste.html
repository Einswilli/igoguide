{% extends 'header-footer.html' %}
{% block content %}
<!DOCTYPE html>{% load static %}
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" />
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="{% static 'js/jquery.min.js'%}"></script>

 <style>
   .container{
    padding: 0.5%;
   }
</style>
<style>
    @font-face {
        font-family: 'badaboom_bbregular';
        src: url({% static "assets/fonts/badabb__-webfont.woff2"%}) format('woff2'),
            url({% static "asstes/fonts/badabb__-webfont.woff"%}) format('woff');
        font-weight: normal;
        font-style: normal;
    }
    @font-face {
        font-family: 'Bangers';
        src: url({% static "assets/fonts/bangers.ttf"%});
    }         
    @media only screen and (min-width:1100px){
        .mycontainer{
            margin: 25px 25px;
            display:grid;
            grid-template-columns: 7fr 4fr;
        }
        .map{
            background-color: gray;
            position:sticky !important;
            top:0;
            left:0;
            height: 90vh;
            width: 100%;
            margin-left: 15px;
        }
    }
    .marker{
        transform: translate(-50%,calc(100%-10px));
        white-space:nowrap;
        font-size: 16px;
        padding: 5px 10px;
        text-align: center;
        background-color: white;
        box-shadow: 0 0 2px #29282862
    }
    .marker::after{
        content: '';
        position: absolute;
        top:100%;
        left: 50%;
        width: 0px;
        height: 0px;
        margin-left: -8px;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-left: 8px solid #FFFFFF;
    }
    .marker.is-active{
        background-color: #569ff5;
        color:#FFFFFF;
        z-index:300;
    }
    .marker.is-active::after{
        border-top-color: #569ff5;
    }
    .marker.is-current{
        --parentHeight:200px;
        width: 230px;
        height: 230px;
        z-index: 500;
        background-color: transparent;
        /* top: calc(45vh -300px); */
    }
    .marker.is-current .ltn__blog-img, .face-back{
        height: var(--parentHeight);
        width: var(--parentHeight);
    }
    .marker.is-current .face-back{
        height: var(--parentHeight);
        width: var(--parentHeight);
    }
    .marker.is-current .ltn__blog-item{
        height: var(--parentHeight);
        width: var(--parentHeight);
    }
    .h{
        background-color:black;
        color:yellow;
    }

    .ic{
        color:yellow;
    }

    .h:hover{
        background-color:rgb(0, 234, 255);
        color:black;
    }


    .h:hover .ic{
        color:black;
    }

    .like {
        animation: like 1500ms ;
      }

    @keyframes like {
        0%   {  top: 0px;
                opacity:0;
                transform: rotate(45deg);
                background:#0071bd00;
              }
        25%  {  top: 10px;
                transform: rotate(-45deg);
                opacity:1;
              }
        50%   { top: 0px;
                opacity:0;
                transform: rotate(45deg);
              }
        75%  {  top: 10px;
                transform: rotate(-45deg);
                opacity:1;
              }

        100% {  top: 10px;
                opacity:1;
              }
      }
    .ltn__blog-item{
        height:300px;
        position:relative;
    }
    .ltn__blog-item .ltn__blog-img{
        box-shadow:0 5px 5px black;
        overflow: hidden;
        transform: perspective(600px) rotateY(0deg);
    }
    .ltn__blog-brief,.ltn__blog-meta , .carousel-caption{
        height:auto;
        box-sizing: border-box;
        padding:10px;
        border-radius:8px;
        position:absolute;
        bottom:150px;
        background:rgb(27,27,27,.5);
        color:#FFFFFF;
    }
    .likee{
        right:3%;
        top:3%;
        height:30px;
        width:30px; 
        /*padding:3px 3px 3px 3px;*/
        border-radius:12px;
        position:absolute;
        background:transparent; /*rgb(255,255,255,.4);*/
        color:#FFFFFF;
        text-align:center;
    }
    .ltn__blog-meta > h6 > p{
        color:#FFFFFF;
    }
    .ltn__blog-meta > h3{
        color:#FFFFFF;
    }
    .carousel-caption > h6{
        visibility:hiden;
    }
    .carousel-caption > a{
        visibility:hiden;
    }
    .ltn__blog-img,.face-back{
        position:absolute;
        width:100%;
        height:300px;
        backface-visibility: hidden;
        overflow:hidden;
        transition:.5s;
        border-radius:15px;
    }
    .ltn__blog-item .face-back{
        /*position:absolute;*/
        transform: perspective(600px) rotateY(180deg);
        box-shadow: 0 5px 10px black;
        background:#11101D;
        padding:15px;
        color:#FFFFFF;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }
    .ltn__blog-item:hover .face-back{
        transform: perspective(600px) rotateY(360deg);
        box-shadow: 0 5px 10px black;
        position:absolute;
    }
    .ltn__blog-item:hover .ltn__blog-img{
        transform: perspective(600px) rotateY(180deg);
        box-shadow: 0 5px 10px black;
        height:0px;
    }


    a{
        text-decoration: none !important;
    }
    .card {
      color: #fff;
      min-height: 350px;
      box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
      border: none !important;
    }
    .card.card-bg {
      background-size: 120%;
      background-repeat: no-repeat;
      background-position: center center;
    }
    .card.card-bg:hover {
      cursor: pointer;
      background-size: 130%;
      transition: all 500ms cubic-bezier(0.19, 1, 0.22, 1);
    }
    .card .card-footer {
      border-top: none;
      background: none;
    }
    .card .card-footer .media img {
      border: solid 4px #fff;
    }
    .card .card-meta {
        background: #41c2cb;
        padding: 5px;
    }
    .card .card-img-overlay {
      background: linear-gradient(0deg, rgba(35, 79, 109, 0.5) 0%, #41c2cb 100%);
    }
    .card-title {
      font-weight: 600;
    }
    .card-head i{
        font-weight: 600;
        font-size: 26px;
    }

    body { 
        width: 100%;
        height:100%;
        font-family: 'Open Sans', sans-serif;
        background: #092756;
        background: -moz-radial-gradient(0% 100%, ellipse cover, rgba(104,128,138,.4) 10%,rgba(138,114,76,0) 40%),-moz-linear-gradient(top,  rgba(57,173,219,.25) 0%, rgba(42,60,87,.4) 100%), -moz-linear-gradient(-45deg,  #670d10 0%, #092756 100%);
        background: -webkit-radial-gradient(0% 100%, ellipse cover, rgba(104,128,138,.4) 10%,rgba(138,114,76,0) 40%), -webkit-linear-gradient(top,  rgba(57,173,219,.25) 0%,rgba(42,60,87,.4) 100%), -webkit-linear-gradient(-45deg,  #670d10 0%,#092756 100%);
        background: -o-radial-gradient(0% 100%, ellipse cover, rgba(104,128,138,.4) 10%,rgba(138,114,76,0) 40%), -o-linear-gradient(top,  rgba(57,173,219,.25) 0%,rgba(42,60,87,.4) 100%), -o-linear-gradient(-45deg,  #670d10 0%,#092756 100%);
        background: -ms-radial-gradient(0% 100%, ellipse cover, rgba(104,128,138,.4) 10%,rgba(138,114,76,0) 40%), -ms-linear-gradient(top,  rgba(57,173,219,.25) 0%,rgba(42,60,87,.4) 100%), -ms-linear-gradient(-45deg,  #670d10 0%,#092756 100%);
        background: -webkit-radial-gradient(0% 100%, ellipse cover, rgba(104,128,138,.4) 10%,rgba(138,114,76,0) 40%), linear-gradient(to bottom,  rgba(57,173,219,.25) 0%,rgba(42,60,87,.4) 100%), linear-gradient(135deg,  #670d10 0%,#092756 100%);
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3E1D6D', endColorstr='#092756',GradientType=1 );
      }

</style>

</head>
<body>
<div class="mami"></div>
        <div class="ltn__blog-area ltn__blog-item-3-normal mb-100">
            {% if text %}
                <h2 style="font-family: Bangers;text-align: center;margin:20px 20px;color:#ffffff ">
                    <span style="color:#ffc823 " data-purecounter-start="0" data-purecounter-end="232" data-purecounter-duration="1" class="purecounter">{{etablissements|length}}</span>
                    resultats trouves par igoguide pour &ldquo; {{text}}! &rdquo;
                </h2>
            {% endif %}
            <div class="mycontainer">
                <div class="row mr-10">
                    {% if not etablissements or etablissements|length < 0 %}
                        <h2 style="text-align:center;margin-top:200px;color:#ffffff;font-family:Bangers;">Aucun résultat!</h2>
                        <img src"{% static 'categories/img_404.jpg'%}" style="height:200px;width:auto;">
                    {% else %}
                {% for etablissement in etablissements %}
                <div class="col-md-6 col-lg-6 col-sm-6 js-marker mb-30" data-lat="{{etablissement.latitude}}" data-lng="{{etablissement.longitude}}" data-num="{{etablissement.id}}">
                    {% comment %} {% for image in etablissement.images %} {% endcomment %}
                    <div class="card card-bg" style="background-image:url('{{ etablissement.images.0.url }}');">
                        <div class="card-img-overlay d-flex flex-column">
                        <div class="card-head d-flex justify-content-end">
                            {% if etablissement.id in client.favorites %}
                                <i class="far fa-heart" id="fav_{{etablissement.id}}" title="retirer {{ etablissement.name }} des favoris" style="color:deeppink;"></i>
                                <script>
                                    $('#fav_{{etablissement.id}}').click(function(){
                                        $('#fav_{{etablissement.id}}').css('color','white');
                                        $('#fav_{{etablissement.id}}').title="ajouter  {{ etablissement.name }} aux favoris"
                                        $.ajax({
                                            type:'DELETE',
                                            url:'/favorites/delete/'+localStorage.getItem('clientid')+'/'+{{ etablissement.id }},
                                            data:{
                                                'client':localStorage.getItem('clientid'),
                                                'etablishment':{{ etablissement.id }}
                                            },
                                            success: function(){
                                                console.log('deleted')
                                            },
                                            error: function(err){
                                                $('#fav_{{etablissement.id}}').css('color','deeppink');
                                                $('#fav_{{etablissement.id}}').title="retirer  {{ etablissement.name }} des favoris"
                                                $.ajax({
                                                    type:'POST',
                                                    url:'/favorites/new',
                                                    data:{
                                                        'client':localStorage.getItem('clientid'),
                                                        'etablishment':{{ etablissement.id }}
                                                    },
                                                    success: function(res){
                                                        //$('#fav_{{etablissement.id}}').css('color','deeppink');
                                                        console.log('added')
                                                    }
                                                })
                                            }
                                        })
                                    })
                                </script>
                            {% else %}
                            <i class="far fa-heart" id="fav_{{etablissement.id}}" title="ajouter  {{ etablissement.name }} aux favoris"></i>
                            <script>

                                $('#fav_{{etablissement.id}}').click(function(){

                                    //UTILISATEUR NON CONNECTÉ!
                                    if(!localStorage.hasOwnProperty('clientid')){
                                        
                                        $.ajax({
                                            type:'GET',
                                            url:'/redirect/to/login',
                                            success: function(){
                                                console.log('redirected to login')
                                            }
                                        })
                                    }else{
                                        getUser()
                                    }
                                })
                                function getUser(){
                                    var uid=localStorage.getItem('clientid')
                                    $.ajax({
                                        type:'GET',
                                        url:'/users/p/'+uid,
                                        data:{},
                                        success: function(client){
                                            if(client.favorites.includes({{ etablissement.id }})==false){
                                                $('#fav_{{etablissement.id}}').css('color','deeppink');
                                                $('#fav_{{etablissement.id}}').title="retirer  {{ etablissement.name }} des favoris"
                                                $.ajax({
                                                    type:'POST',
                                                    url:'/favorites/new',
                                                    data:{
                                                        'client':localStorage.getItem('clientid'),
                                                        'etablishment':{{ etablissement.id }}
                                                    },
                                                    success: function(res){
                                                        console.log('added')
                                                    }
                                                })
                                            }else{
                                                $('#fav_{{etablissement.id}}').css('color','white');
                                                $('#fav_{{etablissement.id}}').title="ajouter  {{ etablissement.name }} aux favoris"
                                                $.ajax({
                                                    type:'DELETE',
                                                    url:'/favorites/delete/'+localStorage.getItem('clientid')+'/'+{{ etablissement.id }},
                                                    data:{},
                                                    success: function(res){
                                                        console.log('deleted')
                                                    }
                                                })
                                            }
                                        },
                                        error: function(err){
                                            console.log('ERROR:FRRRR  '+err.Message)
                                        }
                                    })
                                }
                            </script>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <small class="card-meta mb-2" style="font-size:20px;">{{ etablissement.name }}</small>
                            <h4 class="card-title">
                                <a href="/etablishment/{{ etablissement.id }}" style="text-decoration:none;color:#FFFFFF"><i class="fa fa-location-dot"></i> {{ etablissement.address }}</a>
                            </h4>
                            <small><i class="bx bxs-dashboard"></i> {{ etablissement.subType }}</small>
                        </div>
                        <div class="card-footer">
                          <div class="media">
                            <img alt="..."
                                 class="mr-3 rounded-circle"
                                 src="{{etablissement.owner.Photo.url}}" style="max-width:50px;min-height:50px">
                            <div class="media-body">
                              <h6 class="my-0 text-white d-block">{{ etablissement.owner.FName }} {{ etablissement.owner.LName }}</h6>
                              <small>{{ etablissement.owner.Email }}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                        {% comment %} <div class="col-lg-4 col-sm-6 col-12 js-marker" data-lat="{{etablissement.latitude}}" data-lng="{{etablissement.longitude}}" data-num="{{etablissement.id}}" style="border-radius:10px">
                            <div class="ltn__blog-item ltn__blog-item-3" style="margin-top:10%; border-radius:10px">
                                <div class="ltn__blog-img " style="background-color:black;border-radius:15px;border-top-right-radius:15px">
                                <div id="carouselExampleIndicators" class="carousel slide carousel-fade" data-bs-ride="carousel">
                                    
                                    <div class="carousel-indicators">
                                        {% for image in etablissement.images %}
                                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{forloop.counter}}"  class="{% if forloop.first %} active {% endif %}" aria-current="true"></button>
                                        {% endfor %}
                                        
                                    </div>

                                        <div class="carousel-inner ltn__blog-img ima" style="height:300px;background-color:rgb(223, 200, 200);border-radius:15px;border-top-right-radius:15px;margin:0;padding:0" role="listbox">
                                            {% for image in etablissement.images %}
                                              <div class="carousel-item {% if forloop.first %} active {% endif %}" style="height:300px;background-color:rgba(71, 71, 71, 0.498);border-radius:15px;border-top-right-radius:15px;margin:0;padding:0">
                                                <img style="max-height:100%;max-width:100%;height:100%;width:auto" src="{{ image.url }}" class="d-block w-100" alt="{{image.name}}">
                                                <div class="carousel-caption text-center">
                                                  <h6> <p href="#" class="categorie2" style="color: rgb(2, 131, 191);font-style:italic"><div style="visibility:hiden; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;color:#ffffff;font-size:20px;" class="fst-italic"><i class="fa-solid fa-house"></i>{{etablissement.name}}</div></p></h6>
                                              </div>
                                              </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <div class="face-back">
                                    <h3><i class="fa-solid fa-arrow-circle-right"></i>{{etablissement.type}}</h3>
									                  <p>Description</p>
                                    <h6> <p href="#" class="categorie2" style="color: rgb(2, 131, 191);font-style:italic"><div style="overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;color:#ffffff;font-size:14px;" class="fst-italic"><i class="fa fa-info-card"></i> {{etablissement.presentation}}</div></p></h6>
                                    <h6> <p href="#" class="categorie2" style="color: rgb(2, 131, 191);font-style:italic"><div style="overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;color:#ffffff;font-size:14px;" class="fst-italic"><i class="fa fa-fa-location-dot"></i> {{etablissement.address}}</div></p></h6>
                                    <div class="" style="display:flex;justify-content:space-between;padding-left:30px;padding-right:30px;">
                                        <a title="Détailles sur {{etablissement.name}}" class="btn btn-primary" href="/etablishment/{{etablissement.id}}" style="width:60%"><i class="fa fa-list"></i> Détails</a>
                                        <button class="btn btn-danger" title="Supprimer {{etablissement.name}}" data-toggle="modal" data-target="#deletemodal"><i class="fa fa-heart"></i></button><!--<i class="bi bi-trash">-->
                                    </div>
                                    <p></p>
                                </div>
                            </div>
                        </div> {% endcomment %}
                    {% endfor %}
                  {% endif %}
                
                </div>
                <div class="map" id="map">

                </div>
            </div>
        </div>

    </div>


</body>
</html>

<script src="{% static 'js/vendor.js'%}"></script>
<script src="{% static 'js/map.js'%}"></script>
{% endblock content %}